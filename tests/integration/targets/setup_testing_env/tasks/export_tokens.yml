---
# Export API tokens to environment variables and files for subsequent test runs

- name: Export technitium01 token to file
  copy:
    content: "{{ technitium_tokens[('technitium01' + (lookup('env', 'CONTAINER_SUFFIX') | default('')))].token }}"
    dest: "{{ lookup('env', 'TOKEN_FILE_1') | default('/tmp/technitium01_token') }}"
  when: technitium_tokens[('technitium01' + (lookup('env', 'CONTAINER_SUFFIX') | default('')))] is defined

- name: Export technitium02 token to file  
  copy:
    content: "{{ technitium_tokens[('technitium02' + (lookup('env', 'CONTAINER_SUFFIX') | default('')))].token }}"
    dest: "{{ lookup('env', 'TOKEN_FILE_2') | default('/tmp/technitium02_token') }}"
  when: technitium_tokens[('technitium02' + (lookup('env', 'CONTAINER_SUFFIX') | default('')))] is defined

- name: Export technitium03 token to file  
  copy:
    content: "{{ technitium_tokens[('technitium03' + (lookup('env', 'CONTAINER_SUFFIX') | default('')))].token }}"
    dest: "{{ lookup('env', 'TOKEN_FILE_3') | default('/tmp/technitium03_token') }}"
  when: technitium_tokens[('technitium03' + (lookup('env', 'CONTAINER_SUFFIX') | default('')))] is defined

- name: Export technitium_cluster_primary token to file  
  copy:
    content: "{{ technitium_tokens[('technitium_cluster_primary' + (lookup('env', 'CONTAINER_SUFFIX') | default('')))].token }}"
    dest: "{{ lookup('env', 'TOKEN_FILE_4') | default('/tmp/technitium_cluster_primary_token') }}"
  when: technitium_tokens[('technitium_cluster_primary' + (lookup('env', 'CONTAINER_SUFFIX') | default('')))] is defined

- name: Export technitium_cluster_secondary01 token to file  
  copy:
    content: "{{ technitium_tokens[('technitium_cluster_secondary01' + (lookup('env', 'CONTAINER_SUFFIX') | default('')))].token }}"
    dest: "{{ lookup('env', 'TOKEN_FILE_5') | default('/tmp/technitium_cluster_secondary01_token') }}"
  when: technitium_tokens[('technitium_cluster_secondary01' + (lookup('env', 'CONTAINER_SUFFIX') | default('')))] is defined

- name: Export technitium_cluster_secondary02 token to file  
  copy:
    content: "{{ technitium_tokens[('technitium_cluster_secondary02' + (lookup('env', 'CONTAINER_SUFFIX') | default('')))].token }}"
    dest: "{{ lookup('env', 'TOKEN_FILE_6') | default('/tmp/technitium_cluster_secondary02_token') }}"
  when: technitium_tokens[('technitium_cluster_secondary02' + (lookup('env', 'CONTAINER_SUFFIX') | default('')))] is defined